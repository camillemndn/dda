---
title: "dICS"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{dICS}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
  %\VignetteDepends{tidyverse}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(dda)
library(tidyverse)
library(GGally)
```

```{r preprocessing}
data(vietnam_temperature)
selected_years <- 2013:2016

vnt <- vietnam_temperature |>
  filter(year %in% selected_years) |>
  filter(region %in% c("NMM", "RRD") | province %in% c("ANGIANG", "BACLIEU")) |>
  arrange(region, province) |>
  mutate(across(c(t_min, t_max), \(x) as_dd(x, lambda = 1, nbasis = 11)))

vnt |> plot_funs(t_max, color = region)
```

```{r ics}
t_max_ics <- ICS(as_dd(vnt$t_max), center = TRUE)
plot(t_max_ics$gen_kurtosis)

ggpairs(as.data.frame(t_max_ics$scores),
  diag = "blank",
  columns = c(1:3, 8:9),
  aes(label = seq_len(nrow(vnt)), color = vnt$region, shape = NA)
) + geom_text()
```

```{r ics_outlier}
t_max_out <- ICS_outlier(t_max, verbose = TRUE)
ICS_outlier(as.fd(t_max), verbose = TRUE)
```

```{r checks}
round(inprod(center.dd(t_max), t_max_ics$W) - t_max_ics$scores, 2)
round(inprod(center.fd(t_max), ICS.fd(t_max)$W) - ICS.fd(t_max, center = T)$scores, 2)
```
