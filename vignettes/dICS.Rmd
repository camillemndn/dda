---
title: "dICS"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{dICS}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
  %\VignetteDepends{tidyverse}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(dda)
library(tidyverse)
```

```{r preprocessing}
data(vietnam_temperature)
selected_year <- 1987

temps <- vietnam_temperature |>
  filter(year == selected_year) |>
  group_by(region)

smooth <- function(...) {
  density(
    rangeval = c(10, 40),
    lambda = 0, nbasis = 11, ...
  )
}

temps <- temps |> mutate(t_max_dd = lapply(t_max, smooth))
t_max <- dda:::merge.dd(temps$t_max_dd)
plot(t_max)
```

```{r ics}
t_max_ics <- ICS(t_max)
plot(t_max_ics)
plot(t_max_ics$W)
```

```{r checks}
all(round(fda::inprod(t_max, t_max_ics$W) - t_max_ics$scores, 2) == 0)
```

```{r ics_outlier}
t_max_out <- ICS_outlier(t_max)
plot(t_max_out)
plot(t_max) + scale_color_manual(values = t_max_out$outliers + 1)
fda::plot.fd(t_max, col = t_max_out$outliers + 1)
```
