---
title: "density_estimation"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{density_estimation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(dda)
library(tidyverse)
```

```{r mean_by_region}
data(vietnam_temperature)
data(vietnam_regions)

selected_year <- 1987

temp <- vietnam_temperature |>
  filter(year == selected_year) |>
  dplyr::group_by(region)

smooth <- function(...) {
  density(
    rangeval = c(20, 37),
    lambda = 1, nbasis = 30, ...
  )
}

temp <- temp |> mutate(t_max_dd = lapply(t_max, smooth))

mean_by_region <- temp |> summarize(mean = list(mean(dda:::merge.dd(t_max_dd))))

plot(dda:::merge.dd(mean_by_region$mean))

# Total mean
plot(mean(dda:::merge.dd(mean_by_region$mean)))
```

```{r ics}
plot(dda:::ICS.fd(dda:::merge.dd(temp$t_max_dd))$W)
```

